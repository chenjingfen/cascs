!function(F,D){"use strict";var h="ht",o=h+".layout.",C=F[h]||module.parent.exports.ht,r=C.List,u=C.DataModel,S=C.Node,Q=C.Edge,A=C.Group,$=Math,V=$.sqrt,p=$.random,M=$.max,t=$.min,i=function(J){return J*J};C.Default.getInternal().addMSMap({ms_force:function(l){l._interval=50,l._stepCount=10,l._motionLimit=.01,l._edgeRepulsion=.65,l._nodeRepulsion=.65,l._damper=1,l._maxMotion=0,l._motionRatio=0,l.init=function(A){var v=this;A instanceof u?v.dm=A:v.gv=A,v._nodeMap={},v._nodes=new r,v._edges=new r},l.start=function(){var G=this,E=G.gv;if(!G._timer){var Q=G.cdm=E?E.dm():G.dm;Q.mm(G.handleDataModelChange,G),Q.md(G.handleDataPropertyChange,G),E&&E.mp(G.handleGV,G),Q.each(function(b){if(G.isVisible(b)&&G.isLayoutable(b)&&b instanceof S)if(G instanceof y){var x=b.p3();b.p3([x[0]+p(),x[1]+p(),x[2]+p()])}else x=b.p(),b.p(x.x+p(),x.y+p())}),G._timer=setInterval(function(){G.relax()},G._interval),G._damper=1}},l.stop=function(){var E=this;E._timer&&(E.cdm.umm(E.handleDataModelChange,E),E.cdm.umd(E.handleDataPropertyChange,E),E.gv&&E.gv.ump(E.handleGV,E),clearInterval(E._timer),delete E._timer,delete E.cdm)},l.handleGV=function(w){var v=this;if("dataModel"===w.property){var U=w.oldValue,r=w.newValue;U&&(U.umm(v.handleDataModelChange,v),U.umd(v.handleDataPropertyChange,v)),this.cdm=r,r.mm(v.handleDataModelChange,v),r.md(v.handleDataPropertyChange,v)}},l.relax=function(){var q=this;if(!(q._damper<.1&&q._maxMotion<q._motionLimit)){this.cdm.each(function(n){q.isVisible(n)&&(n instanceof Q?q.addEdge(n):n instanceof S&&q.addNode(n))});for(var D,x,O=0,J=q._edges,M=q._nodes,z=M.size();O<q._stepCount;O++){for(J.each(q.relaxEdge,q),D=0;z>D;D++)for(x=0;z>x;x++)q.relaxNode(M.get(D),M.get(x));q.moveNode()}q._isAdjusting=1,M.each(function(v){v.fix||(v.p?v.v.p3(v.p):v.v.p(v.x,v.y))}),delete q._isAdjusting,q._nodeMap={},M.clear(),J.clear(),q.onRelaxed()}},l.onRelaxed=function(){},l.isRunning=function(){return!!this._timer},l.isVisible=function(I){return I.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(I):!0},l.isLayoutable=function(F){if(F.s("layoutable")===!1)return!1;if(F instanceof A)return!1;var b=this;return b.gv?b.gv.isMovable(F)&&!b.gv.isSelected(F):!(b.cdm||b.dm).sm().co(F)},l.getNodeRepulsion=function(){return this._nodeRepulsion},l.setNodeRepulsion=function(P){this._nodeRepulsion=P,this._damper=1},l.getEdgeRepulsion=function(){return this._edgeRepulsion},l.setEdgeRepulsion=function(G){this._edgeRepulsion=G,this._damper=1},l.getStepCount=function(){return this._stepCount},l.setStepCount=function(d){this._stepCount=d,this._damper=1},l.getInterval=function(){return this._interval},l.setInterval=function(a){var Z=this;Z._interval!==a&&(Z._interval=a,Z._timer&&(clearInterval(Z._timer),Z._timer=setInterval(function(){Z.relax()},a)))},l.handleDataPropertyChange=function(l){!this._isAdjusting&&this.isVisible(l.data)&&(this._damper=1)},l.handleDataModelChange=function(){this._damper=1},l.damp=function(){var O=this._maxMotion,F=this._damper;this._motionRatio<=.001&&((.2>O||O>1&&.9>F)&&F>.01?this._damper-=.01:.4>O&&F>.003?this._damper-=.003:F>1e-4&&(this._damper-=1e-4)),O<this._motionLimit&&(this._damper=0)}}}),C.layout.ForceLayout=function(i){this.init(i)},C.Default.def(o+"ForceLayout",D,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(F){this._limitBounds=F,this._damper=1},getNodeSize:function(j){var A=this.gv;return A&&A.getDataUIBounds?A.getDataUIBounds(j):j.getRect()},addNode:function(a){var o=this,p=o._nodeMap[a._id];if(p)return p;var N=a.p();p={v:a,x:N.x,y:N.y,dx:0,dy:0,fix:!o.isLayoutable(a),s:o.getNodeSize(a)};var t=p.s,W=V(i(t.width)+i(t.height))*o._nodeRepulsion;return p.r=1>W?100:W,o._nodeMap[a._id]=p,o._nodes.add(p),p},addEdge:function(x){if(x._40I&&x._41I){var G=this,Y=G.addNode(x._40I),e=G.addNode(x._41I),j={s:Y,t:e};e=e.s,Y=Y.s;var l=e.width+Y.width,n=e.height+Y.height;j.length=V(l*l+n*n)*G._edgeRepulsion,j.length<=0&&(j.length=100),G._edges.add(j)}},relaxEdge:function(J){var x=J.t,d=J.s,F=x.x-d.x,T=x.y-d.y,z=V(F*F+T*T),O=100*J.length,w=.25*F/O*z,o=.25*T/O*z;x.dx=x.dx-w,x.dy=x.dy-o,d.dx=d.dx+w,d.dy=d.dy+o},relaxNode:function(C,e){if(C!==e){var H=0,I=0,i=C.x-e.x,s=C.y-e.y,F=i*i+s*s;0===F?(H=p(),I=p()):36e4>F&&(H=i/F,I=s/F);var a=C.r*e.r/400;H*=a,I*=a,C.dx+=H,C.dy+=I,e.dx-=H,e.dy-=I}},moveNode:function(){var C=this,N=C._limitBounds,O=C._maxMotion,b=0,y=C._damper;C._nodes.each(function(A){if(!A.fix){var g=A.dx*y,o=A.dy*y;if(A.dx=g/2,A.dy=o/2,b=M(V(g*g+o*o),b),A.x+=M(-40,t(40,g)),A.y+=M(-40,t(40,o)),N){A.x<N.x&&(A.x=N.x,C.adjust(1,0)),A.y<N.y&&(A.y=N.y,C.adjust(0,1));var K=A.s;A.x+K.width>N.x+N.width&&(A.x=N.x+N.width-K.width,C.adjust(-1,0)),A.y+K.height>N.y+N.height&&(A.y=N.y+N.height-K.height,C.adjust(0,-1))}}}),C._maxMotion=b,C._motionRatio=b>0?O/b-1:0,C.damp()},adjust:function(M,E){var p=this._limitBounds;this._nodes.each(function(B){M>0?(!p||B.x+B.s.width+M<p.x+p.width)&&(B.x+=M):(!p||B.x+M>p.x)&&(B.x+=M),E>0?(!p||B.y+B.s.height+E<p.y+p.height)&&(B.y+=E):(!p||B.y+E>p.y)&&(B.y+=E)})}});var y=C.layout.Force3dLayout=function(X){this.init(X)};C.Default.def(o+"Force3dLayout",D,{ms_force:1,getNodeSize3d:function(C){return C.s3()},addNode:function(Z){var P=this,r=P._nodeMap[Z._id];if(r)return r;r={v:Z,p:Z.p3(),d:[0,0,0],fix:!P.isLayoutable(Z),s:P.getNodeSize3d(Z)};var s=r.s,u=C.Default.getDistance(s)*P._nodeRepulsion;return r.r=1>u?100:u,P._nodeMap[Z._id]=r,P._nodes.add(r),r},addEdge:function(T){if(T._40I&&T._41I){var P=this,r=P.addNode(T._40I),M=P.addNode(T._41I),F={s:r,t:M};M=M.s,r=r.s,F.length=V(i(M[0]+r[0])+i(M[1]+r[1])+i(M[2]+r[2]))*P._edgeRepulsion,F.length<=0&&(F.length=100),P._edges.add(F)}},relaxEdge:function(L){var y=L.t.p,N=L.s.p,x=L.t.d,D=L.s.d,g=y[0]-N[0],P=y[1]-N[1],b=y[2]-N[2],l=V(g*g+P*P+b*b),R=100*L.length,T=.25*g/R*l,B=.25*P/R*l,o=.25*b/R*l;x[0]-=T,x[1]-=B,x[2]-=o,D[0]+=T,D[1]+=B,D[2]+=o},relaxNode:function(U,M){if(U!==M){var f=U.p,j=M.p,s=0,z=0,v=0,N=f[0]-j[0],b=f[1]-j[1],Q=f[2]-j[2],V=N*N+b*b+Q*Q;0===V?(s=p(),z=p(),v=p()):216e6>V&&(s=N/V,z=b/V,v=Q/V);var E=U.r*M.r/400,r=U.d,e=M.d;s*=E,z*=E,v*=E,r[0]+=s,r[1]+=z,r[2]+=v,e[0]-=s,e[1]-=z,e[2]-=v}},moveNode:function(){var A=this,q=A._maxMotion,T=0,S=A._damper;A._nodes.each(function(u){if(!u.fix){var D=u.p,w=u.d,P=w[0]*S,c=w[1]*S,j=w[2]*S;w[0]=P/2,w[1]=c/2,w[2]=j/2,T=M(V(P*P+c*c+j*j),T),D[0]+=M(-40,t(40,P)),D[1]+=M(-40,t(40,c)),D[2]+=M(-40,t(40,j))}}),A._maxMotion=T,A._motionRatio=T>0?q/T-1:0,A.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);